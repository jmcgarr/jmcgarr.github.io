<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Build Once, Deploy Many</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Personal website of Mike McGarr - Passionate engineering leader and manager.">
    <meta name="author" content="https://twitter.com/SonOfGarr">
    <meta name="keywords" content="">
    <meta name="generator" content="JBake">

    <!-- Bootstrap core CSS -->
    <link href="/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom fonts for this template -->
    <link href="/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- Custom styles for this template -->
    <link href="/css/clean-blog.min.css" rel="stylesheet">

    <!-- previous styles -->
    <link href="/css/asciidoctor.css" rel="stylesheet">
    <link href="/css/extra.css" rel="stylesheet">

    <link rel="shortcut icon" href="/favicon.ico">
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-49993013-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
  </head>
  <body>
    <script src="//platform.linkedin.com/in.js" type="text/javascript">
     lang: en_US
    </script>
    <div id="wrap">

      <!-- Navigation -->
      <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
        <div class="container">
          <a class="navbar-brand" href="/">Mike McGarr</a>
          <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
            Menu
            <i class="fas fa-bars"></i>
          </button>
          <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav ml-auto">
              <li class="nav-item">
                <a class="nav-link" href="/index.html">Home</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/about.html">About</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/archive.html">Blog</a>
              </li>

              <li class="nav-item">
                <a class="nav-link" href="/talks.html">Talks</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/feed.xml">Subscribe</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>

      
<!-- Grab masthead data -->

      <!-- Page Header -->
      <header class="masthead" style="background-image: url('/img/masthead/saocom-falcon-launch.jpg')">
        <div class="overlay"></div>
        <div class="container">
          <div class="row">
            <div class="col-lg-8 col-md-10 mx-auto">
              <div class="page-heading">
                <h1>Build Once, Deploy Many</h1>
                  <span class="subheading"><em>September 09, 2010</em></span>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="">
            </div>
          </div>
        </div>
        <div class="container">
          <div class="row justify-content-between">
            <div class="col-4"></div>
            <div class="col-4 text-right">
              <p class="photo-credit">Photo credit:
                  <a href="https://www.flickr.com/photos/spacex/44451125454/" target="_blank">https://www.flickr.com/photos/spacex/44451125454/</a>
              </p>
            </div>
          </div>
        </div>
      </header>

		<div class="container">

        <div class="col-lg-8 col-md-10 mx-auto">

        	<p><p>It is not uncommon to find a development team building their application binary from source every time they deploy a new version of their application to an environment.  While this approach works (and depending on the technology, may be necessary), it introduces significant opportunities for errors and makes debugging a failed deployment increasingly difficult.  By migrating to a <strong><em>Build Once, Deploy Many</em></strong> approach, your team can simplify their deployment process, by making it repeatable and easier to debug.</p>
<p style="text-align:center;"><img class="aligncenter" title="Build Once Deploy Many" src="https://docs.google.com/drawings/pub?id=1DWlh5PbduUlPMwlWVYxLH3YQbUtPbntXeNpfMO2MqZ4&amp;w=791&amp;h=383" alt="" width="487" height="235" /></p>
<p>In my experience, if you are rebuilding the application from source every time you deploy, it makes it harder to isolate deployment issues.  Specifically, it is hard to tell if the problem is the result of  a build time issue (the developer's responsibility), or a runtime environment issue (the sysadmin's responsibility).   So, when a deployment does fail, the inevitable battle between developers and sysadmins ensues, with fingers pointing at each other and denial emails flying.  Hopefully you work in a collaborative environment where there isn't contention between developers and sysadmins, but I still argue, there is a better way.</p>
<p><strong>What does "Build Once, Deploy Many" Mean?</strong></p>
<p>Rather than compiling and rebuilding your application for every environment you plan to deploy to, build your application binary only once, and then migrate the same binary file from Development to Test and then to Production.  By building once and deploying that binary many times, you have eliminated half of the aforementioned deploy time variables that could lead to errors.  For example, if your binary file worked fine in the development environment, but failed to run in the test environment, it quickly becomes clear that there is a delta between these two environments.</p>
<p><strong>Official Builds</strong></p>
<p>In order to adopt this approach, you will need to make sure that your build process is highly automated and repeatable, allowing you to produce an <em><span style="text-decoration:underline;">official build</span></em>.  In order to produce official builds, you need to be drawing your source code from a version control system like <a href="http://subversion.tigris.org/" target="_blank">Subversion</a>, running an automated build with tools like <a href="http://ant.apache.org/" target="_blank">Ant</a> or <a href="http://maven.apache.org/" target="_blank">Maven</a>, and lastly you need a dedicated build machine, preferably a <a href="http://martinfowler.com/articles/continuousIntegration.html" target="_blank">continuous integration</a> server.</p>
<p>Most teams already use version control and build automation, so I won't belabor their tenets.  By adding a dedicated build machine to the mix, you are increasing consistency at build time and eliminating variables when producing an official build.  I would avoid using a developer's machine as the dedicated build machine, as this likely an unstable environment with limited accessibility.  The dedicated build machine should be available to all team members.  Continuous integration servers, like <a href="http://hudson-ci.org/" target="_blank">Hudson</a>, provide a simple solution to this requirement and add much more value to your development process...for free!</p>
<p><strong>Binary Repositories</strong></p>
<p>Once the binary is produced, it should archived for future retrieval in a binary repository.  In Java, this is greatly simplified with tools like Maven and Ant+<a href="http://ant.apache.org/ivy/" target="_blank">Ivy</a> which provide simple mechanisms for archiving binaries at build time.  The Maven project has defined a <a href="http://www.sonatype.com/books/mvnex-book/reference/simple-project-section-simple-repo.html" target="_blank">standard structure</a> for a Java binary files repository, which can be accessed in Ant through Ivy.  These repositories are simple to setup, since they are built on a file system, so the only question is how you provide access to these repositories.  You could setup an Apache HTTP server to provide access, but I have found that Maven <a href="http://maven.apache.org/repository-management.html" target="_blank">repository managers</a>, like <a href="http://nexus.sonatype.org/" target="_blank">Nexus</a>, provide search repository caching that also adds value to an organization.</p>
<p><strong>Environment Agnostic</strong></p>
<p><strong> </strong>One of the major problems that most people have with this approach is Environment Variables.  One of the reasons teams build a new binary per environment is to inject environment variables into the source code, building a binary specific to the target environment.  <a href="http://ant.apache.org/manual/Tasks/property.html" target="_blank">Ant properties</a> and <a href="http://maven.apache.org/guides/getting-started/index.html#How_do_I_filter_resource_files" target="_blank">Maven filters</a> can make this very easy, but I would like to propose a much better approach.</p>
<p>The goal should be to build an <em><span style="text-decoration:underline;">environment agnostic</span></em> binary file that discovers any environment specific information at startup.  There are a number of ways to do this, but I find that it is easiest to do this in the database.  When your application starts up, it looks into the database and loads data from a key/value pair table that contains environment specific properties.  The reason I prefer using the database to say, a property file, is that you have already setup an environment specific configuration for your <a href="http://www.oracle.com/technetwork/java/index-jsp-137536.html" target="_blank">JNDI</a> data source in the application server.  You also likely already have some type of deployment process for the database, which you can utilize to manage the key/value table.  If you don't, then I recommend looking at a database management tool like <a href="http://www.liquibase.org/" target="_blank">Liquibase</a>, which I mentioned in my <a href="/blog/intro-to-liquibase.html" target="_blank">previous post</a>.</p>
<p>To further simplify this implementation, I recommend using a configuration abstraction framework like <a href="http://commons.apache.org/configuration/" target="_blank">Commons Configuration</a>, which allows you to load properties from a variety of sources, including a database.</p>
<p><strong>Automate</strong></p>
<p>I would be remiss if I did not mention <span style="text-decoration:underline;"><em>automated testing</em></span>.  You could implement a Build Once Deploy Many approach without implementing any automated tests, but you that your confidence in your builds increases significantly if you automate your tests and integrate them into your build process.  If you are able to achieve test coverage of 80% or higher, you will find you are able to make changes faster and deploy more often with less headaches.</p>
<p>What you will find once you implement this process is that it enables a variety of other process improvements.   One of these processes is <em><span style="text-decoration:underline;">automated deployments</span></em>, which your continuous integration server can easily orchestrate this whole process and provide you with nightly and/or push button deployments.</p>
</p>

					<p><em>Share this:</em></p>
          <p style="float:left">
                <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://www.mikemcgarr.com/blog/build-once-deploy-many.html" data-via="SonOfGarr" data-lang="fr">Tweeter</a>
                <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
                <div class="g-plusone" data-size="medium" data-href="http://www.mikemcgarr.com/blog/build-once-deploy-many.html"></div>
                <script type="IN/Share" data-url="http://www.mikemcgarr.com/blog/build-once-deploy-many.html" data-counter="right"></script>
                <div class="fb-like" data-href="http://www.mikemcgarr.com/blog/build-once-deploy-many.html" data-layout="button_count" data-action="like" data-show-faces="false" data-share="true"></div>
          </p>

          <hr>

          <div id="disqus_thread">
          <script type="text/javascript">
                var disqus_shortname = 'mikemcgarr';
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
          </script>
          <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
          </div>
        </div>
    </div>

		</div>
		<div id="push"></div>
    </div>

		<!-- Footer -->
    <footer>
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-md-10 mx-auto">
            <ul class="list-inline text-center">
              <li class="list-inline-item">
                <a href="https://twitter.com/SonOfGarr">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li class="list-inline-item">
                <a href="https://www.linkedin.com/in/jmcgarr/">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li class="list-inline-item">
                <a href="https://github.com/jmcgarr">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
            </ul>
						<p class="copyright text-muted">All posts on this blog are published with a <em>Creative Commons by-nc-sa</em> license.<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"/></a></p>
            <p class="copyright text-muted">Copyright &copy; Mike McGarr 2009-2018 | Mixed with <a href="http://getbootstrap.com/">Bootstrap v4.1</a> | Generated with <a href="http://jbake.org">JBake v2.6.4</a></p>
          </div>
        </div>
      </div>
    </footer>


    <!-- Bootstrap core JavaScript -->
    <script src="/vendor/jquery/jquery.min.js"></script>
    <script src="/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Custom scripts for the clean blog look and feel -->
    <script src="/js/clean-blog.min.js"></script>

    <script type="text/javascript">
      (function() {
        var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
        po.src = 'https://apis.google.com/js/platform.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
      })();
    </script>
  </body>
</html>
